name: Test and deploy

on:
  pull_request:

env:
  CLOJURE_CLI_VERSION: "1.11.1.1347"

jobs:
  test:
    runs-on: ubuntu-20.04
    strategy:
      matrix:
        jdk: [ '8', '11', '17', '21' , '22' ]
        clojure: [ '1.11.0', '1.11.1', '1.11.2', '1.11.3', '1.12.0-alpha9' ]
    fail-fast: false
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK ${{ matrix.jdk }}
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: ${{ matrix.jdk }}
      - uses: DeLaGuardo/setup-clojure@0fc99a3bcdd086349bfb01a9262382fe3d37cd6d
        with:
          cli: ${{ env.CLOJURE_CLI_VERSION }} 
      - run: clojure -Sdeps '{:deps {org.clojure/clojure {:mvn/version "'$CLOJURE_VERSION'"}} :mvn/repos {"sonatype-oss-public" {:url "https://oss.sonatype.org/content/groups/public/"}}}' -M:test -e "(do (require,'typed-test.ann.clojure),(in-ns,'typed-test.ann.clojure),(or (cljs/is-tc-e (rest [1 2 3])       (t/Seq t/Num)) (System/exit 1))))"
        env:
          CLOJURE_VERSION: ${{ matrix.clojure }}
